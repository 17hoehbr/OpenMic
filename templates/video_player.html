{% extends 'tv_base.html' %}
{% block head %}
  <style>
    video{
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
{% endblock %}

{% block content %}
  <video id="video">
      <source src="/songs/{{ song }}.mp4" type="video/mp4">
      Your browser does not support the video tag.
  </video>

  <script>
    const socket = io("{{ url_for('tv') }}");
    const video = document.getElementById('video');

    // // autoplay workaround
    window.onload = function() {
      socket.emit('autoplay_workaround');
    };
    
    socket.on('player_restart', function() {
      video.currentTime = 0;
    });

    socket.on('player_pause', function() {
      if (!video.paused) {
          video.pause();
          socket.emit('player_paused')
      } else {
          video.play();
          socket.emit('player_resumed')
      }
    });

    socket.on('player_skip', function() {
      video.currentTime = video.duration;
    });

    document.addEventListener('keydown', function(event) {
      if (event.keyCode === 32) {
        if (video.paused) {
            video.play();
        } else {
            video.pause();
        }
      }
    });

    video.addEventListener('ended',function(){
      socket.emit('song_ended')
      location.href = "{{ url_for('tv') }}";
    });

  </script>
{% endblock %}